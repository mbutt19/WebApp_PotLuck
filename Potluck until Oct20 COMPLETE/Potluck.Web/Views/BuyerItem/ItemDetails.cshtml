@model Potluck.Web.Models.ItemDTO

@{
    ViewData["Title"] = "ItemDetails";

    if (ViewBag.SellerConflict == null)
    {
        ViewBag.SellerConflict = false;
    }

}

<style>
    td {
        text-align: center;
    }
    .z-depth-5 {
        margin: 10vh 11vw;
    }
    table {
        margin: 1vh 2vw 4vh .3vw;
    }
    h5 {
        margin: 0;
        padding: 2vh 0;
    }
    span a {
        margin-left: 5.3vw;
        text-decoration: none;
        color: gray;
        min-width: 16vw;
        max-width: 16vw;
    }
    label input {
        margin-left: 0;
        padding-left: 0;
        margin-right: 2vw;
        float: left;
    }
    .btns {
        width: 80%;
        margin: 0 auto;
    }
    #newOrderCard {
        background-color: whitesmoke;
        border: 3px inset red;
        font-family: Arial, Helvetica, sans-serif;
    }
        #newOrderCard p {
            font-weight: bold;
        }
    .down {
        margin-top: 2vh;
    }
</style>

<div class="container">
    @if (ViewBag.SellerConflict)
    {
        <div class="row card-panel z-depth-4 hoverable center-align Radical-Red-Text" id="newOrderCard">
            <div class="col s12">
                <h4><b>Would you Like to start a new order?</b></h4>
            </div>
            <div class="col s12 left-align">
                <p>Your current order contains items from another seller. If you would like to proceed you will need to start another order.</p>
            </div>
            <div class="col s8 left-align down">
                <p>You will need to re-select the items you wish to purchase.</p>
            </div>
            <div class="col s2 down">
                <a class="btn-floating" asp-action="NewOrder" asp-route-itemId="@Model.itemId">Yes</a>
            </div>
            <div class="col s2 down">
                <a class="btn-floating" onclick="hideNewOrderCard()">No</a>
            </div>
        </div>
    }
    <h3 class="center Radical-Red-Text" style="font-family:Arial, Helvetica, sans-serif;font-weight:bold;font-size:2.85rem;margin:70px 0 50px 0;padding-left:3vw;">Item Details</h3>
    <div class="row card-panel z-depth-5">
        <div class="row center-align">
            @if (Model.imageUrl == null)
            {
                <img src="~/images/no-camera.png" style="max-height:23vh;min-height:15vh;zoom:2;max-width:100%;" />
            }
            else
            {
                <img src="@Model.imageUrl" style="max-height:23vh;min-height:23vh;zoom:2;" />
            }

            @if (!Model.enable)
            {
                <p>This item is currently unavailable.</p>
            }
            else
            {
                <p><a class="Radical-Red-Text" asp-controller="Profile" asp-action="AddFavorite" asp-route-itemId="@Model.itemId">♥ Add Item To Favorites</a></p>
            }
            <div>
                <h4>@Html.DisplayFor(model => model.name)</h4>
                <hr />
                <table>
                    <tr>
                        <th><b>Item ID</b></th>
                        <td>@Html.DisplayFor(model => model.itemId)</td>
                    </tr>
                    <tr>
                        <th><b>Calories</b></th>
                        <td>@Html.DisplayFor(model => model.calories)</td>
                    </tr>
                    <tr>
                        <th><b>Price</b></th>
                        <td>$@Html.DisplayFor(model => model.price)</td>
                    </tr>
                    <tr>
                        <th><b>Description</b></th>
                        <td>@Html.DisplayFor(model => model.description)</td>
                    </tr>
                </table>
            </div>
            <input value="@Model.price" id="@Model.itemId" name="PrimaryItem" hidden />
            @if (Model.customs != null)
            {
                @foreach (CustomDTO custom in Model.customs)
                {
                    <div class="row card-panel z-depth-1">
                        <h5 class=" Radical-Red white-text">@custom.customTitle</h5>
                        @if (custom.customType == "SELECT_ONE")
                        {
                            <form name="CustomSelect" id="@custom.customId">
                                <table>
                                    <tr>
                                        <th></th>
                                        <th>Choose One</th>
                                        <th></th>
                                        <th>Name</th>
                                        <th></th>
                                        <th>Calories</th>
                                        <th></th>
                                        <th>Price</th>
                                    </tr>
                                    @foreach (SubItemDTO subItem in custom.subItems)
                                    {
                                        @if (subItem.enable && subItem.name != null && subItem.itemId != "0")
                                        {
                                            <tr>
                                                <td colspan="8" class="left-align">
                                                    <label>
                                                        <input class="left-align" value="@subItem.price" id="@subItem.itemId" name="subitems" type="radio" />
                                                        <span style="margin-left:4vw;display:inline">
                                                            <b><a>@subItem.name</a></b>
                                                            <span style="float:right">
                                                                <a style="padding:0;margin:0;margin-right:6vw;">@subItem.calories cal </a>
                                                                <a style="margin:0;padding:0;margin-right:1vw">$@Html.DisplayFor(modelItem => subItem.price)</a>
                                                            </span>
                                                        </span>
                                                    </label>
                                                </td>
                                            </tr>
                                        }
                                    }
                                </table>
                            </form>
                        }
                        else
                        {
                            <form name="CustomSelect" id="@custom.customId">
                                <table>
                                    <tr>
                                        <th></th>
                                        <th>Choose Any</th>
                                        <th></th>
                                        <th>Name</th>
                                        <th></th>
                                        <th>Calories</th>
                                        <th></th>
                                        <th>Price</th>
                                    </tr>
                                    @foreach (SubItemDTO subItem in custom.subItems)
                                    {
                                        @if (subItem.enable && subItem.name != null)
                                        {
                                            <tr>
                                                <td colspan="8" class="left-align">
                                                    <label>
                                                        <input type="checkbox" value="@subItem.price" id="@subItem.itemId" name="@subItem.name" />
                                                        <span style="margin-left:4vw; margin-right:0;display:inline">
                                                            <b><a style="padding:0;margin:0;margin-left:5vw;">@subItem.name </a></b>
                                                            <span style="float:right">
                                                                <a style="padding:0;margin:0;margin-right:6vw;">@subItem.calories cal </a>
                                                                <a style="margin:0;padding:0;margin-right:1vw">$@Html.DisplayFor(modelItem => subItem.price)</a>
                                                            </span>
                                                        </span>
                                                    </label>
                                                </td>
                                            </tr>
                                        }
                                    }
                                </table>
                            </form>
                        }
                    </div>
                }
            }
            <div class="row btns">
                @if (Model.enable == true)
                {
                    <a style="border-radius:25px;background-color:#F42E56;height:8vh;margin:6vh 1vw;padding-top:1vh;" class="btn waves-effect waves-light col s5 hoverable" onclick="AddItemsToList()">Add to Order<i class="small material-icons" style="padding-left:1vw;">shopping_cart</i></a>
                    <a style="border-radius:25px;background-color:#F42E56;height:8vh;margin:6vh 1vw;padding-top:1vh;" class="btn waves-effect waves-light col s5 hoverable" asp-controller="BuyerItem" asp-action="ShowMenu" asp-route-userId="@Model.user.userId">Show User Menu</a>
                }
                else
                {
                    <a style="border-radius:25px;background-color:#F42E56;height:8vh;margin:6vh 2vw;padding-top:1vh;width:13vw;" class="btn waves-effect waves-light col s3 hoverable" asp-controller="BuyerItem" asp-action="ShowMenu" asp-route-userId="@Model.user.userId">Show User Menu</a>
                }
            </div>
        </div>
    </div>
</div>

<script>
    function AddItemsToList() {
        var PrimaryItem = document.getElementsByName("PrimaryItem")[0];

        var CustomSelections = document.getElementsByName("CustomSelect");

        var ordersItem =
        {
            itemId: PrimaryItem.id,
            ordersItemsCustoms: [],
            ordersItemsId: 0,
            price: PrimaryItem.value,
            quantity: 1
        };

        if (CustomSelections.length > 0) {

            for (var i = 0; i < CustomSelections.length; i++) {

                var CustomSelection = CustomSelections[i];

                var custom =
                {
                    customId: CustomSelection.id,
                    ordersItemsCustomId: 0,
                    subitems: []
                }

                var CustomInputs = CustomSelection.getElementsByTagName("input");

                if (CustomInputs.length > 0) {

                    for (var j = 0; j < CustomInputs.length; j++) {

                        if (CustomInputs[j].checked) {
                            custom.subitems.push({ itemId: CustomInputs[j].id });
                        }
                    }
                    ordersItem.ordersItemsCustoms.push(custom);
                }

            }
        }

        var JsonString = JSON.stringify(ordersItem);
        console.log(ordersItem);
        window.location.href = '/BuyerOrder/AddItemToOrder/?json=' + JsonString;
    }
</script>